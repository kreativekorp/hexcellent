package com.kreative.templature.test;

import java.io.ByteArrayInputStream;
import java.math.BigInteger;
import com.kreative.templature.template.BufferedCountedInputStream;
import com.kreative.templature.template.Closure;
import com.kreative.templature.template.item.Base128Item;

public class Base128InputTest extends AbstractTest {
	private static final int[][] BEB128_TESTS = {
		{0x0000000,  0x0000000, 0x00},
		{0x000003F,  0x000003F, 0x3F},
		{0x0000040, -0x0000040, 0x40},
		{0x000007F, -0x0000001, 0x7F},
		{0x0000000,  0x0000000, 0x80, 0x00},
		{0x000003F,  0x000003F, 0x80, 0x3F},
		{0x0000040,  0x0000040, 0x80, 0x40},
		{0x000007F,  0x000007F, 0x80, 0x7F},
		{0x0000000,  0x0000000, 0x80, 0x80, 0x00},
		{0x000003F,  0x000003F, 0x80, 0x80, 0x3F},
		{0x0000040,  0x0000040, 0x80, 0x80, 0x40},
		{0x000007F,  0x000007F, 0x80, 0x80, 0x7F},
		{0x0000000,  0x0000000, 0x80, 0x80, 0x80, 0x00},
		{0x000003F,  0x000003F, 0x80, 0x80, 0x80, 0x3F},
		{0x0000040,  0x0000040, 0x80, 0x80, 0x80, 0x40},
		{0x000007F,  0x000007F, 0x80, 0x80, 0x80, 0x7F},
		
		{0x0000080,  0x0000080, 0x81, 0x00},
		{0x00000FF,  0x00000FF, 0x81, 0x7F},
		{0x0001F80,  0x0001F80, 0xBF, 0x00},
		{0x0001FFF,  0x0001FFF, 0xBF, 0x7F},
		{0x0002000, -0x0002000, 0xC0, 0x00},
		{0x000207F, -0x0001F81, 0xC0, 0x7F},
		{0x0003F80, -0x0000080, 0xFF, 0x00},
		{0x0003FFF, -0x0000001, 0xFF, 0x7F},
		{0x0000080,  0x0000080, 0x80, 0x81, 0x00},
		{0x00000FF,  0x00000FF, 0x80, 0x81, 0x7F},
		{0x0001F80,  0x0001F80, 0x80, 0xBF, 0x00},
		{0x0001FFF,  0x0001FFF, 0x80, 0xBF, 0x7F},
		{0x0002000,  0x0002000, 0x80, 0xC0, 0x00},
		{0x000207F,  0x000207F, 0x80, 0xC0, 0x7F},
		{0x0003F80,  0x0003F80, 0x80, 0xFF, 0x00},
		{0x0003FFF,  0x0003FFF, 0x80, 0xFF, 0x7F},
		{0x0000080,  0x0000080, 0x80, 0x80, 0x81, 0x00},
		{0x00000FF,  0x00000FF, 0x80, 0x80, 0x81, 0x7F},
		{0x0001F80,  0x0001F80, 0x80, 0x80, 0xBF, 0x00},
		{0x0001FFF,  0x0001FFF, 0x80, 0x80, 0xBF, 0x7F},
		{0x0002000,  0x0002000, 0x80, 0x80, 0xC0, 0x00},
		{0x000207F,  0x000207F, 0x80, 0x80, 0xC0, 0x7F},
		{0x0003F80,  0x0003F80, 0x80, 0x80, 0xFF, 0x00},
		{0x0003FFF,  0x0003FFF, 0x80, 0x80, 0xFF, 0x7F},
		
		{0x0004000,  0x0004000, 0x81, 0x80, 0x00},
		{0x0007FFF,  0x0007FFF, 0x81, 0xFF, 0x7F},
		{0x00FC000,  0x00FC000, 0xBF, 0x80, 0x00},
		{0x00FFFFF,  0x00FFFFF, 0xBF, 0xFF, 0x7F},
		{0x0100000, -0x0100000, 0xC0, 0x80, 0x00},
		{0x0103FFF, -0x00FC001, 0xC0, 0xFF, 0x7F},
		{0x01FC000, -0x0004000, 0xFF, 0x80, 0x00},
		{0x01FFFFF, -0x0000001, 0xFF, 0xFF, 0x7F},
		{0x0004000,  0x0004000, 0x80, 0x81, 0x80, 0x00},
		{0x0007FFF,  0x0007FFF, 0x80, 0x81, 0xFF, 0x7F},
		{0x00FC000,  0x00FC000, 0x80, 0xBF, 0x80, 0x00},
		{0x00FFFFF,  0x00FFFFF, 0x80, 0xBF, 0xFF, 0x7F},
		{0x0100000,  0x0100000, 0x80, 0xC0, 0x80, 0x00},
		{0x0103FFF,  0x0103FFF, 0x80, 0xC0, 0xFF, 0x7F},
		{0x01FC000,  0x01FC000, 0x80, 0xFF, 0x80, 0x00},
		{0x01FFFFF,  0x01FFFFF, 0x80, 0xFF, 0xFF, 0x7F},
		
		{0x0200000,  0x0200000, 0x81, 0x80, 0x80, 0x00},
		{0x03FFFFF,  0x03FFFFF, 0x81, 0xFF, 0xFF, 0x7F},
		{0x7E00000,  0x7E00000, 0xBF, 0x80, 0x80, 0x00},
		{0x7FFFFFF,  0x7FFFFFF, 0xBF, 0xFF, 0xFF, 0x7F},
		{0x8000000, -0x8000000, 0xC0, 0x80, 0x80, 0x00},
		{0x81FFFFF, -0x7E00001, 0xC0, 0xFF, 0xFF, 0x7F},
		{0xFE00000, -0x0200000, 0xFF, 0x80, 0x80, 0x00},
		{0xFFFFFFF, -0x0000001, 0xFF, 0xFF, 0xFF, 0x7F},
		
		{ 624485,  624485, 0xA6, 0x8E, 0x65},
		{1973696, -123456, 0xF8, 0xBB, 0x40},
		{0,0}, {0,0,0x80}, {7,7,0x87}
	};
	
	private static final int[][] LEB128_TESTS = {
		{0x0000000,  0x0000000, 0x00},
		{0x000003F,  0x000003F, 0x3F},
		{0x0000040, -0x0000040, 0x40},
		{0x000007F, -0x0000001, 0x7F},
		{0x0000000,  0x0000000, 0x80, 0x00},
		{0x000003F,  0x000003F, 0xBF, 0x00},
		{0x0000040,  0x0000040, 0xC0, 0x00},
		{0x000007F,  0x000007F, 0xFF, 0x00},
		{0x0000000,  0x0000000, 0x80, 0x80, 0x00},
		{0x000003F,  0x000003F, 0xBF, 0x80, 0x00},
		{0x0000040,  0x0000040, 0xC0, 0x80, 0x00},
		{0x000007F,  0x000007F, 0xFF, 0x80, 0x00},
		{0x0000000,  0x0000000, 0x80, 0x80, 0x80, 0x00},
		{0x000003F,  0x000003F, 0xBF, 0x80, 0x80, 0x00},
		{0x0000040,  0x0000040, 0xC0, 0x80, 0x80, 0x00},
		{0x000007F,  0x000007F, 0xFF, 0x80, 0x80, 0x00},
		
		{0x0000080,  0x0000080, 0x80, 0x01},
		{0x00000FF,  0x00000FF, 0xFF, 0x01},
		{0x0001F80,  0x0001F80, 0x80, 0x3F},
		{0x0001FFF,  0x0001FFF, 0xFF, 0x3F},
		{0x0002000, -0x0002000, 0x80, 0x40},
		{0x000207F, -0x0001F81, 0xFF, 0x40},
		{0x0003F80, -0x0000080, 0x80, 0x7F},
		{0x0003FFF, -0x0000001, 0xFF, 0x7F},
		{0x0000080,  0x0000080, 0x80, 0x81, 0x00},
		{0x00000FF,  0x00000FF, 0xFF, 0x81, 0x00},
		{0x0001F80,  0x0001F80, 0x80, 0xBF, 0x00},
		{0x0001FFF,  0x0001FFF, 0xFF, 0xBF, 0x00},
		{0x0002000,  0x0002000, 0x80, 0xC0, 0x00},
		{0x000207F,  0x000207F, 0xFF, 0xC0, 0x00},
		{0x0003F80,  0x0003F80, 0x80, 0xFF, 0x00},
		{0x0003FFF,  0x0003FFF, 0xFF, 0xFF, 0x00},
		{0x0000080,  0x0000080, 0x80, 0x81, 0x80, 0x00},
		{0x00000FF,  0x00000FF, 0xFF, 0x81, 0x80, 0x00},
		{0x0001F80,  0x0001F80, 0x80, 0xBF, 0x80, 0x00},
		{0x0001FFF,  0x0001FFF, 0xFF, 0xBF, 0x80, 0x00},
		{0x0002000,  0x0002000, 0x80, 0xC0, 0x80, 0x00},
		{0x000207F,  0x000207F, 0xFF, 0xC0, 0x80, 0x00},
		{0x0003F80,  0x0003F80, 0x80, 0xFF, 0x80, 0x00},
		{0x0003FFF,  0x0003FFF, 0xFF, 0xFF, 0x80, 0x00},
		
		{0x0004000,  0x0004000, 0x80, 0x80, 0x01},
		{0x0007FFF,  0x0007FFF, 0xFF, 0xFF, 0x01},
		{0x00FC000,  0x00FC000, 0x80, 0x80, 0x3F},
		{0x00FFFFF,  0x00FFFFF, 0xFF, 0xFF, 0x3F},
		{0x0100000, -0x0100000, 0x80, 0x80, 0x40},
		{0x0103FFF, -0x00FC001, 0xFF, 0xFF, 0x40},
		{0x01FC000, -0x0004000, 0x80, 0x80, 0x7F},
		{0x01FFFFF, -0x0000001, 0xFF, 0xFF, 0x7F},
		{0x0004000,  0x0004000, 0x80, 0x80, 0x81, 0x00},
		{0x0007FFF,  0x0007FFF, 0xFF, 0xFF, 0x81, 0x00},
		{0x00FC000,  0x00FC000, 0x80, 0x80, 0xBF, 0x00},
		{0x00FFFFF,  0x00FFFFF, 0xFF, 0xFF, 0xBF, 0x00},
		{0x0100000,  0x0100000, 0x80, 0x80, 0xC0, 0x00},
		{0x0103FFF,  0x0103FFF, 0xFF, 0xFF, 0xC0, 0x00},
		{0x01FC000,  0x01FC000, 0x80, 0x80, 0xFF, 0x00},
		{0x01FFFFF,  0x01FFFFF, 0xFF, 0xFF, 0xFF, 0x00},
		
		{0x0200000,  0x0200000, 0x80, 0x80, 0x80, 0x01},
		{0x03FFFFF,  0x03FFFFF, 0xFF, 0xFF, 0xFF, 0x01},
		{0x7E00000,  0x7E00000, 0x80, 0x80, 0x80, 0x3F},
		{0x7FFFFFF,  0x7FFFFFF, 0xFF, 0xFF, 0xFF, 0x3F},
		{0x8000000, -0x8000000, 0x80, 0x80, 0x80, 0x40},
		{0x81FFFFF, -0x7E00001, 0xFF, 0xFF, 0xFF, 0x40},
		{0xFE00000, -0x0200000, 0x80, 0x80, 0x80, 0x7F},
		{0xFFFFFFF, -0x0000001, 0xFF, 0xFF, 0xFF, 0x7F},
		
		{ 624485,  624485, 0xE5, 0x8E, 0x26},
		{1973696, -123456, 0xC0, 0xBB, 0x78},
		{0,0}, {0,0,0x80}, {7,7,0x87}
	};
	
	public void run() throws Exception {
		for (int[] td : BEB128_TESTS) {
			byte[] data = new byte[td.length];
			for (int i = 0; i < td.length; i++) data[i] = (byte)td[i];
			ByteArrayInputStream bin = new ByteArrayInputStream(data, 2, td.length - 2);
			Base128Item item = new Base128Item(0, "", "", false, false, 10);
			Base128Item.Instance inst = item.read(new Closure(null), new BufferedCountedInputStream(bin));
			BigInteger v = inst.getValue();
			record(v.equals(BigInteger.valueOf(td[0])), v, td[0]);
			
			bin = new ByteArrayInputStream(data, 2, td.length - 2);
			item = new Base128Item(0, "", "", false, true, 10);
			inst = item.read(new Closure(null), new BufferedCountedInputStream(bin));
			v = inst.getValue();
			record(v.equals(BigInteger.valueOf(td[1])), v, td[1]);
		}
		
		for (int[] td : LEB128_TESTS) {
			byte[] data = new byte[td.length];
			for (int i = 0; i < td.length; i++) data[i] = (byte)td[i];
			ByteArrayInputStream bin = new ByteArrayInputStream(data, 2, td.length - 2);
			Base128Item item = new Base128Item(0, "", "", true, false, 10);
			Base128Item.Instance inst = item.read(new Closure(null), new BufferedCountedInputStream(bin));
			BigInteger v = inst.getValue();
			record(v.equals(BigInteger.valueOf(td[0])), v, td[0]);
			
			bin = new ByteArrayInputStream(data, 2, td.length - 2);
			item = new Base128Item(0, "", "", true, true, 10);
			inst = item.read(new Closure(null), new BufferedCountedInputStream(bin));
			v = inst.getValue();
			record(v.equals(BigInteger.valueOf(td[1])), v, td[1]);
		}
	}
	
	public static void main(String[] args) {
		new Base128InputTest().main();
	}
}
